# neclassflows ğŸŒŠ

**neclassflows** is an R package designed to streamline the analysis and visualization of data generated by the [NEClass pipeline](https://github.com/Piece-Of-Schmidt/NEClass). While NEClass handles the heavy lifting of context-sensitive entity classification (using LLMs in Python), **neclassflows** empowers researchers to explore, aggregate, and visualize the resulting data within the familiar R ecosystem.

It provides a set of intuitive functions to track international news flows, identify dominant actors over time, and harmonize entity labels for robust quantitative analysis.

## ğŸš€ Key Features

* **ğŸ“ˆ Flow Analysis**: aggregate entity mentions over time (e.g., monthly shares of "USA" or "China" coverage) at both entity and document levels.
* **ğŸ† Top-K Extraction**: Automatically identify the most salient actors or countries per period (e.g., "Who were the top 5 foreign actors in 2015?").
* **ğŸ§¹ Data Harmonization**: flexible tools to merge synonyms and resolve conflicting labels based on custom dictionaries.
* **ğŸ“Š Document-Level Aggregation**: Convert entity-level data into document-feature matrices (wide format) for regression analysis or structural topic modeling.

---

## ğŸ“¦ Installation

You can install the development version of NeclassFlows directly from GitHub:

```r
# install.packages("devtools")
devtools::install_github("Piece-Of-Schmidt/neclassflows")

```

---

## ğŸ›  Usage Example

Here is a typical workflow: analyzing the shift in foreign news attention in a dataset of German newspaper articles.

### 1. Load Data & Harmonize Labels

First, clean up the raw output from NEClass. Map different labels to broader categories if desired.

```r
library(neclassflows)
library(dplyr)

# Assume 'neclass_output' is the CSV from the Python pipeline
data <- read.csv("neclass_output.csv")

# Define a mapping dictionary
mappings <- list(
  "Maghreb" = c("Morocco", "Algeria", "Tunisia", "Libya", "Mauritania"),
  "Benelux"  = c("Belgium", "Netherlands", "Luxembourg")
)

# Apply harmonization
clean_data <- harmonize_data(
  data, 
  maps = mappings, 
  along = "label", 
  out_col = "clean_label"
)

```

### 2. Analyze News Flows over Time

Calculate the monthly share of attention for specific target countries.

```r
# Calculate monthly visibility of USA and EU
flows <- summarize_flows(
  clean_data,
  margin = "entities",               # Calculate share based on total entities
  targets = c("Maghreb", "Benelux"), # only consider entities with specific labels
  label_col = "clean_label",
  date_unit = "month"
)

# Visualize with ggplot2
library(ggplot2)

ggplot(flows, aes(x = date, y = share, color = clean_label)) +
  geom_line(size = 1.2) +
  theme_minimal() +
  labs(title = "International Attention Share over Time", y = "Share of Entities")

```

### 3. Identify Top Actors

Who drove the coverage during a specific time period?

```r
top_actors <- top_items_per_period(
  clean_data,
  item = "word",                 # We want to find specific entities (e.g., "Bart De Wever")
  label_of_interest = "Benelux", # Only look at entities classified as "Belgium", "Netherlands" or "Luxembourg
  k = 5,                         # Top 5 per month
  unit = "month",
  label_col = "clean_label"
)

head(top_actors)

```

### 4. Prepare for Regression (Article-Level)

Create a dataset where each row is an article, and columns represent country counts.

```r
doc_matrix <- article_level_matrix(
  clean_data,
  id_col = "doc_id",
  label_col = "clean_label"
)

# Result:
# doc_id | n_Maghreb | n_Benelux | n_China ...
# 1024   |     2     |     0     |    1    ...

```

---

## ğŸ“š Function Reference

| Function | Description |
| --- | --- |
| `harmonize_data()` | Merges labels or entities based on a dictionary (e.g., regex matching). |
| `summarize_flows()` | Aggregates data by time period (counts, shares, document hits). |
| `top_items_per_period()` | Ranks top entities or labels within time units (supports tie-breaking). |
| `article_level_matrix()` | Pivots data to wide format (one row per document) for downstream stats. |
| `validate_columns()` | Helper to ensure input data meets pipeline requirements. |

---

## ğŸ¤ Relation to NEClass

This package is the analytical companion to **[NEClass](https://github.com/Piece-Of-Schmidt/NEClass)**.

* **Use NEClass (Python)** to extract entities from text and classify them (e.g., "BVB" -> "Germany").
* **Use neclassflows (R)** to make sense of that data, create time-series plots, and run statistical models.

This separation of concerns allows you to run computationally expensive classification on a GPU server (or Colab) while performing exploratory analysis locally in R Studio.

---

## ğŸ–Š Citation

`neclassflows` is part of the NEClass methodological framework. Please cite the main paper:

```bibtex
@article{schmidt2026neclass,
  title={NEClass: A Lightweight LLM Pipeline for Context-Dependent Named Entity Classification},
  author={Schmidt, Tobias},
  journal={Draft Version / TU Dortmund University},
  year={2026}
}

```
